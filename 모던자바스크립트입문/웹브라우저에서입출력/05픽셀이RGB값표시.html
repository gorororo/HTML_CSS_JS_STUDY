<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>픽셀의 RGB 값</title>
        <style>
            canvas {
                border: 2px solid gray;
            }
        </style>
    </head>
    <body>
        <canvas id="mycanvas" width="640" height="400"></canvas>
        <div><output id="rgb"></output></div>
        <script defer>
            window.addEventListener("DOMContentLoaded", () => {
                const canvas = document.getElementById("mycanvas");
                const ctx = canvas.getContext("2d");
                // 이미지 객체 생성
                const img = new Image();
                // 이미지 읽어 들인후의 처리
                img.onload = () => {
                    // 읽어들인 이미지를 Canvas에 그리기
                    ctx.drawImage(img, 0, 0);
                    // ImageData 객체 가져오기
                    // (canvas.width와 canvas.height에는 canvas 요소의 너비와 높이가 저장되어 있음)
                    const imageData = ctx.getImageData(
                        0,
                        0,
                        canvas.width,
                        canvas.height
                    );
                    // RGBA 값을 구하는 메서드를 추가
                    imageData.getRGBA = function (m, n, i) {
                        return this.data[this.width * 4 * n + 4 * m + i];
                    };
                    // imageData.getRGBA = (m,n,i)=>({})
                    // const rgb = document.getElementById("rgb");
                    // canvas 요소를 클릭했을 때의 처리
                    canvas.onclick = (event) => {
                        // event는 이벤트 객체
                        const x = event.offsetX; // 마우스로 클릭한 위치의 x좌표
                        const y = event.offsetY; // 마오스로 클릭한 위치의 y좌표
                        rgb.innerHTML =
                        "R:" + to3digit(imageData.getRGBA(x, y, 0))
                        +"G:" + to3digit(imageData.getRGBA(x, y, 1))
                        +"B:" + to3digit(imageData.getRGBA(x, y, 2));
                    };
                };
                img.src = "./cat.jpg";

                //숫자를 세 자리 문자열로 변환하는 함수
                const to3digit = n => ("000" + n).slice(-3);
            });
        </script>
    </body>
</html>
